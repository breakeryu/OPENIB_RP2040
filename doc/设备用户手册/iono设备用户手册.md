设备用户手册

[TOC]



# 一、文档更新时间

| 版本  | 时间          | 更新内容 |
| ----- | ------------- | -------- |
| 0.1.0 | 2023年2月17日 |          |
|       |               |          |
|       |               |          |



​					

# 二、简介



Inon设备参考==[Iono RP](https://www.sferalabs.cc/)==设计，该设备使用树莓派 RP2040 微控制器，使用简单，带有多输入、输出接口；是具有稳定，安全，可靠和易安装等特性的设备模块，适合安装于工业及住宅环境中。

该设备的微控制器为 RP2040，双核 Arm Cortex M0+ 处理器，时钟频率高达 133 MHz，芯片内置有 264KB 的 SRAM，板上另有一个16M bit 的外部闪存。

该设备有一个USB1.1端口用于设备固件更新，也可以用于连接其他USB设备。

## 主要特性：

✅	10-32V直流电源输入，带浪涌和反接保护，1.1A可复位保险丝

✅	RP2040，双核 Arm Cortex M0+处理器，时钟频率高达133 MHz，有264KB的SRAM

✅	16M bit 板载闪存

✅	4路多模式输入：可作为数字电压输入使用，输入范围为：0-30V；或作为模拟电流输入使用，输入范围为：0-20mA

✅	2路可作为不确定电压数字输入或作为TTL输入/输出

✅	输入保护，防静电和瞬时过压

✅	1路缓冲模拟电压输出0-10V，由RP2040 PWM控制输出

✅	4路电源继电器输出，最大切换电压为277V@AC  30V@DC，最大切换电流为5A

✅	标准RS-485接口连接至RP2040 UART串口引脚，具有静电放电保护

✅	支持1-Wire, I2C 和 Wiegand

✅	可增加蓝牙模块

✅	可增加 6 轴姿态角度传感器

✅	定制外壳

# 三、使用和连接方法

## 1、设备接线实例

上板接口：

![image-20230217205218710](https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217205219251-465406856.png)



下板接口：

![image-20230217203525798](https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217203526104-989490063.png)

继电器接口：

![image-20230217190631935](https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217190634176-1466232947.png)



## 2、供电

Iono设备只能使用直流供电，供电范围为：

🟢典型工作范围在 10V 到 32V（min =  9V，max = 33V）

注意接线示意图中（+ -）所示的正确极性。电源供电电路使用自动复位保险丝和高达 ±500V/2欧姆 1.2/50μs 的浪涌保护来实现防反接保护。

## 3、多模式输入

Iono设备具有4路多模式输入功能。根据端子接线，可以输入数字（ON/OFF）、电压（0-30V）或电流（0-25mA）信号。

### 模拟模式

当使用模拟输入（AV1-4、AI1-4）时，将 0-30V 和 0-25mA 转换为 0-3.3V 电平，目的是为了与RP2040模拟输入引脚兼容。使用VSO输出端作为电源，可连接有源或无源 0-20mA（或4-20mA）发送器；上述连接示例图中所示的 0-20mA 发送器为2线无源型。

### 数字模式

在数字模式下，外部的自由端可以连接到端子 VSO 和 DI1-4 之间；或者，DIx 端子可以连接到外部电压信号（在 0-40V 范围内）。

## 4、DI5和DI6数字输入

在端子 VSO 和 DI5-6 之间可以连接外部的自由端；或者，DI5-6 端子可以连接到外部电压信号（在 0-40V 范围内）。

DI5-6 通过保护网络连接到 RP2040 GPIO 输入端。如果您需要绕过保护网络，使用 DI5 或 DI6 作为通用的TTL级（0-5V）输入/输出线，或使用 1-Wire 或 Wiegand，您可以根据下表设置JP2跳线。

![image-20230217211331827](https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217211333338-2142038464.png)

![image-20230217212618090](https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217212620655-479515049.png)

| **PIN** | **DIGITAL INPUT**                                            | **TTL I/O (BYP)**                                            |
| ------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| DI5     | <br /><img src="https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217211949206-614206677.png" alt="image-20230217211948759" style="zoom:67%; transform: rotate(90deg);" /><br /> | <img src="https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217211732515-1755805590.png" alt="image-20230217211730193" style="zoom: 70%; transform: rotate(270deg);" /> |
| DI6     | <br /><img src="https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217211732515-1755805590.png" alt="image-20230217211730193" style="zoom: 70%; transform: rotate(90deg);" /><br /> | <img src="https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217211949206-614206677.png" alt="image-20230217211948759" style="zoom:67%; transform: rotate(270deg);" /> |

> ❗请注意：
>
> 当跳线处于BYP位置时，应该将加到 DI5 或 DI6 的电压限制在+0V和+5V之间（TTL电平）。超过这个电压范围将导致RP2040 和 Iono设备的损坏。

## 5、模拟输出

Iono 设备具有0-10V输出（AO1），可由RP2040的GPIO8引脚控制，配置为PWM输出；PWM输出的0% - 100%占空比转换为0-10V输出电压。

这是一个 [灌电流/拉电流](https://blog.csdn.net/luosuo_xhl/article/details/34883495) 输出（此输出的电流方向可以是正的，也可以是负的）。

## 6、继电器数字输出

Iono 设备有四个单极单掷功率继电器，具有常开触点。这些继电器是由RP2040的不同的GPIO引脚驱动的。

## 7、RS-485串口

Iono 设备使用RP2040 UART0 TX/RX引脚（分别为GPIO16和GPIO17）来实现一个标准的RS-485串口。

只需将其他RS-485 设备的 A、B和GND连接到Iono 设备端子对应的的RS-485引脚即可（A-A，B-B，GND-SH）。

RS-485端口有防ESD和电压浪涌功能，并支持高达115200 bps的半双工通信。

RS-485 TX/RX开关是由RP2040（GPIO25）的一个数字输出引脚控制的。您应该将GPIO25设置为低，以启用RS-485上的传输，并将其设置为高，以允许接收传入的数据。

如果GPIO25保持高，或者在传输过程中没有配置为输出，Iono RP RS-485驱动程序将自动驱动处于主导状态的RS-485线路，因此不会严格要求控制GPIO25来传输数据。

RS-485线路在线路A和B线上有620欧姆的上拉和下拉电阻。偏置电阻确保在空闲期间数据线保持在稳定的电压电平，并防止接收错误。在A和B之间的120欧姆终端电阻也可以启用。

这些电阻可以根据下表启用在JP1上的跳线。

| **A PULL-UP**                                                | **B PULL-DOWN**                                              | **TERMNATION**                                               |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| <img src="https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217214435797-6160052.png" alt="image-20230217214435529" style="zoom:67%; transform: rotate(270deg);" /> | <img src="https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217214519658-1170551354.png" alt="image-20230217214519461" style="zoom:67%;transform: rotate(270deg);" /> | <img src="https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217214543129-528821928.png" alt="image-20230217214542921" style="zoom:67%;transform: rotate(270deg);" /> |



![image-20230217214313416](https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217214314705-656350027.png)

## 8、EERAM

Iono 设备有一个芯片AT24C16 16 Kbit SRAM与EEPROM备份。芯片擦写寿命为100万次。它连接到RP2040 I2C总线(I2C0，引脚2和3，地址：SRAM 0x50，控制寄存器 0x18）。

## 9、引脚映射

下表显示了Iono 设备的输入和输出到RP2040微控制器的相关引脚的映射。

| **Iono RP inputs and outputs** | **RP2040 pins** |
| :----------------------------: | :-------------: |
|        DI1 – AV1 – AI1         |   38 (GPIO26)   |
|        DI2 – AV2 – AI2         |   39 (GPIO27)   |
|        DI3 – AV3 – AI3         |   40 (GPIO28)   |
|        DI4 – AV4 – AI4         |   41 (GPIO29)   |
|    DI5 (digital input mode)    |   35 (GPIO23)   |
|    DI6 (digital input mode)    |   36 (GPIO24)   |
|    DI5 (BYP - TTL I/O mode)    |    9 (GPIO7)    |
|    DI6 (BYP - TTL I/O mode)    |    8 (GPIO6)    |
|               O1               |   16 (GPIO13)   |
|               O2               |   15 (GPIO12)   |
|               O3               |   14 (GPIO11)   |
|               O4               |   13 (GPIO10)   |
|           RS-485 RX            |   28 (GPIO17)   |
|           RS-485 TX            |   27 (GPIO16)   |
| RS-485 TX-ENABLE (active low)  |   37 (GPIO25)   |
|       I2C SDA for EERAM        |    2 (GPIO0)    |
|       I2C SCL for EERAM        |    3 (GPIO1)    |
|            MCU_LED             |   17 (GPIO14)   |
|             BLE_RX             |    6 (GPIO4)    |
|             BLE_TX             |    7 (GPIO5)    |



# 四、结构框图

![结构图](https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230218133749753-586312824.png)

# 五、技术参数

## 电源

| 参数                                        | 典型值                                                       |
| ------------------------------------------- | ------------------------------------------------------------ |
| 正常工作供电电压（VS）                      | 10…32 V⎓ nom. (9…33 V⎓ )<br />带浪涌和反接保护，1.1A可复位保险丝 |
| VS=12V，无输入且继电器关闭时的电流          | 43 mA                                                        |
| VS=12V，数字输入接近VSO且开启继电器时的电流 | 122 mA                                                       |
| VS=24V，无输入且继电器关闭时的电流          | 28 mA                                                        |
| VS=24V，数字输入接近VSO且开启继电器时的电流 | 66 mA                                                        |
| VSO输出电压（最小值）                       | VS - 1 V                                                     |
| VSO输出电流（最大值）                       | 300 mA                                                       |
| 5VO输出电压（典型值）                       | 5.0 V (空载)                                                 |
| 5VO输出电流（最大值）                       | 1000 mA                                                      |
| 5VO过流保护阈值                             | 1200 mA                                                      |
| USB端口输出电流（最大值）                   | 450 mA                                                       |

## 控制结构

| 参数         | 典型值                                                       |
| ------------ | ------------------------------------------------------------ |
| 微控制器型号 | 树莓派RP2040双核Arm Cortex M0+，133 MHz，264KB SRAM， 16M bit板载闪存 |

## 通讯接口

| 参数                     | 典型值                                                       |
| ------------------------ | ------------------------------------------------------------ |
| 串口                     | RS-485半双工控制系统，具有手动或自动收/发管理功能            |
| 波特率                   | 1200 到 115200                                               |
| RS-485 A/B 的ESD保护电压 | ±15 kV 人体模型；±8 kV 接触放电                              |
| RS-485 A/B 的防浪涌保护  | 浪涌保护高达±500 V / 2欧姆1.2/50 μs；10/1000 μs波形峰值600 W脉冲功率 |
| USB接口                  | Micro-USB B插座USB 1.1，支持主机和设备模式                   |

## AV1-AV4: 模拟电压输入

| 参数         | 典型值                                                       |
| ------------ | ------------------------------------------------------------ |
| 输入电压范围 | 0-30V                                                        |
| 输入阻抗     | \> 450 kOhm                                                  |
| ADC特性      | SAR ADC<br />500kS/s max, with 48MHz clock<br />12-bit with 8.7 ENOB |
| 最大线缆长度 | 15 m                                                         |

## AV1-AV4: 模拟电流输入

| 参数         | 典型值                                                       |
| ------------ | ------------------------------------------------------------ |
| 输入电流范围 | 0-25mA                                                       |
| 输入阻抗     | 120 Ohm                                                      |
| ADC特性      | SAR ADC<br />500kS/s max, with 48MHz clock<br />12-bit with 8.7 ENOB |
| 最大线缆长度 | 15 m                                                         |

## AO1: 模拟电压输出

| 参数         | 典型值      |
| ------------ | ----------- |
| 输入电压范围 | 0-10V       |
| 最大输出电流 | 30 mA       |
| 总误差       | ±2 %（MAX） |
| 最大线缆长度 | 15 m        |

## DI1-DI4: 数字输入

| 参数         | 典型值                     |
| ------------ | -------------------------- |
| 输入电压范围 | 0-40V                      |
| 输入阻抗     | 49 kOhm                    |
| 电压阈值     | VIH: 4.9 V<br />VIL: 3.4 V |
| 最大线缆长度 | 30 m                       |

## DI5-DI6: 数字输入

| 参数         | 典型值                     |
| ------------ | -------------------------- |
| 输入电压范围 | 0-40V                      |
| 输入阻抗     | 6.5 kOhm                   |
| 电压阈值     | VIH: 5.1 V<br />VIL: 3.4 V |
| 最大线缆长度 | 30 m                       |

## DI5-DI6: 数字输入/输出

| 参数           | 典型值                     |
| -------------- | -------------------------- |
| 输出电压       | VOL: 0.1 V<br />VOH: 5.0 V |
| 上拉电阻（5V） | 10 kOhm                    |
| 输入电压阈值   | VIH: 1.4 V<br />VIL: 1.1 V |
| 最大线缆长度   | 10 m                       |

## 继电器

| 参数                    | 典型值                                                       |
| ----------------------- | ------------------------------------------------------------ |
| 最大输出触点额定值      | 电阻负载：<br />⭕7A 250VAC/ 28VDC<br />⭕10A 277VAC/ 30VDC (MAX) |
| 额定负载AC1下的电气寿命 | 30000 cycles                                                 |
| 机械寿命                | 5000000 cycles                                               |

## EEPROM

| 参数           | 典型值                  |
| -------------- | ----------------------- |
| 容量           | 16 Kbit (2048 x 8 bits) |
| EEPROM擦写次数 | \> 100000               |
| 数据保存时间   | \> 20 years             |

## 环境

| 参数     | 典型值        |
| -------- | ------------- |
| 工作温度 | -20 to +60 °C |
| 相对湿度 | 5% to 90%     |
| 储存温度 | -30 to +80 °C |
| 防护等级 | IP20          |

# 六、软件开发

编程Iono RP和任何其他基于RP2040的板一样简单，就像树莓派Pico板一样。

您可以使用C/C++或MicroPython，使用任何IDE或工具可为RP2040微控制器或Pico板。

有关如何开始使用RP2040编程的概述，请参阅以下链接：

https://www.raspberrypi.org/documentation/rp2040/getting-started/

有关Iono RP板卡的特定资源和示例，请访问：

https://github.com/sfera-labs/iono-rp

## 兼容Arduino IDE

如果使用Arduino IDE，可以访问仓库获取支持库： https://github.com/sfera-labs/iono。

## 编程接口

Iono 设备具有与树莓派Pico板相同的编程接口： USB和SWD。

![image-20230217220722714](https://img2023.cnblogs.com/blog/1423856/202302/1423856-20230217220725223-1953792775.png)

# 七、仓库参考

## 1、IONO的参考代码

感谢Sfera Labs的开源仓库，这里使用到了下面一些参考：

https://github.com/sfera-labs/iono-rp

[Modbus RTU Slave](https://github.com/sfera-labs/iono/wiki/Modbus-RTU-Slave)

[Modbus RTU Slave library for Arduino](https://github.com/sfera-labs/arduino-modbus-rtu-slave)

## 2、模块驱动
